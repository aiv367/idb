(function(){class e{constructor(e,t){if(this.opts=Object.assign({version:1,onupgradeneeded(){},onsuccess(){},onerror(){},blocked(){}},t),this.request=void 0,this.db=void 0,!(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB))throw"IndexDB: Does not support indexDB";this.open(e,this.opts.version)}open(e,t){let n,r;this.db=new Promise((e,t)=>{n=e,r=t});let o=window.indexedDB.open(e,t);return o.onupgradeneeded=(e=>{this.opts.onupgradeneeded(e.target.result)}),o.onsuccess=(e=>{let t=e.target.result;this.opts.onsuccess(t),t.onversionchange=(e=>{throw t.close(),"IndexDB: Page content has expired, please refresh"}),n(t)}),o.onerror=(e=>{this.opts.onerror(e.target.error),r(e.target.error)}),o.blocked=(e=>{this.opts.blocked(e)}),this.request=o,this.db}close(){return new Promise((e,t)=>{this.db.then(e=>{e.close()})})}store(e){let t=this,n={index:void 0,range:void 0,limit:[0,0]};return{add:n=>new Promise((r,o)=>{t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).add(n);s.onsuccess=r,s.onerror=o})}),update:n=>new Promise((r,o)=>{t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).put(n);s.onsuccess=r,s.onerror=o})}),remove:r=>(void 0!==r&&(n.range=IDBKeyRange.only(r)),new Promise((r,o)=>{n.range?t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).delete(n.range);s.onsuccess=r,s.onerror=o}):r(!1)})),clear:()=>new Promise((n,r)=>{t.db.then(t=>{let o=t.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=n,o.onerror=r})}),gets:(r="next")=>new Promise((o,s)=>{t.db.then(t=>{let i=t.transaction([e],"readonly").objectStore(e),d=!1,a=[],c=n.limit[0],u=n.limit[1];n.index&&(i=i.index(n.index)),i=i.openCursor(n.range,r),i.onsuccess=(e=>{let t=e.target.result;if(!d&&t&&c)return d=!0,void t.advance(c);t?(a.push(t.value),u&&a.length>=u?o(a):t.continue()):o(a)}),i.onerror=(e=>{s(e)})})}),get:r=>(void 0!==r&&(n.range=IDBKeyRange.only(r)),new Promise((r,o)=>{n.range?t.db.then(t=>{let s=t.transaction([e],"readonly").objectStore(e);n.index&&(s=s.index(n.index)),s=s.openCursor(n.range),s.onsuccess=(e=>{r(e.target.result.value)}),s.onerror=(e=>{o(e)})}):r("")})),count:()=>new Promise((r,o)=>{t.db.then(t=>{let s=t.transaction([e],"readonly").objectStore(e);n.index&&(s=s.index(n.index)),s=s.count(n.range),s.onsuccess=(e=>{r(e.target.result)}),s.onerror=(e=>{o(e)})})}),index(e){return n.index=e,this},range(e){return n.range=e,this},limit(e,t){return n.limit=[e,t],this}}}}e.prototype.removeDatabase=function(e){this.request.removeDatabase(e)},"undefined"!=typeof module&&"object"==typeof exports?module.exports=e:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return e}):this.IDB=e}).call(this||("undefined"!=typeof window?window:global));