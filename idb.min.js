class IDB{constructor(e,t){if(this.opts=Object.assign({version:1,onupgradeneeded(){},onsuccess(){},onerror(){},blocked(){}},t),this.request=void 0,this.db=void 0,window.mozIndexedDB||window.webkitIndexedDB)return console.log("不支持indexDB"),!1;this.open(e,this.opts.version)}open(e,t){let r,n;this.db=new Promise((e,t)=>{r=e,n=t});let o=window.indexedDB.open(e,t);return o.onupgradeneeded=(e=>{this.opts.onupgradeneeded(e.target.result)}),o.onsuccess=(e=>{let t=e.target.result;this.opts.onsuccess(t),t.onversionchange=(e=>{t.close(),alert("IndexDB: 页面内容已过期，请刷新")}),r(t)}),o.onerror=(e=>{this.opts.onerror(e.target.error),n(e.target.error)}),o.blocked=(e=>{this.opts.blocked(e)}),this.request=o,this.request}close(){return new Promise((e,t)=>{this.db.then(e=>{e.close()})})}store(e){let t=this,r={index:void 0,range:void 0,limit:[0,0]};return{add:r=>new Promise((n,o)=>{t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).add(r);s.onsuccess=n,s.onerror=o})}),update:r=>new Promise((n,o)=>{t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).put(r);s.onsuccess=n,s.onerror=o})}),remove:()=>new Promise((n,o)=>{r.range?t.db.then(t=>{let s=t.transaction([e],"readwrite").objectStore(e).delete(r.range);s.onsuccess=n,s.onerror=o}):n(!1)}),clear:()=>new Promise((r,n)=>{t.db.then(t=>{let o=t.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=r,o.onerror=n})}),gets:()=>new Promise((n,o)=>{t.db.then(t=>{let s=t.transaction([e],"readonly").objectStore(e),i=!1,d=[],a=r.limit[0],c=r.limit[1];r.index&&(s=s.index(r.index)),s=s.openCursor(r.range),s.onsuccess=(e=>{let t=e.target.result;if(!i&&t&&a)return i=!0,void t.advance(a);t?(d.push(t.value),c&&d.length>=c?n(d):t.continue()):n(d)}),s.onerror=(e=>{o(e)})})}),get:()=>new Promise((n,o)=>{r.range?t.db.then(t=>{let s=t.transaction([e],"readonly").objectStore(e);r.index&&(s=s.index(r.index)),s=s.openCursor(r.range),s.onsuccess=(e=>{n(e.target.result.value)}),s.onerror=(e=>{o(e)})}):n("")}),count:()=>new Promise((n,o)=>{t.db.then(t=>{let s=t.transaction([e],"readonly").objectStore(e);r.index&&(s=s.index(r.index)),s=s.count(r.range),s.onsuccess=(e=>{n(e.target.result)}),s.onerror=(e=>{o(e)})})}),index(e){return r.index=e,this},range(e){return r.range=e,this},limit(e,t){return r.limit=[e,t],this}}}}IDB.prototype.removeDatabase=function(e){this.request.removeDatabase(e)};export default IDB;